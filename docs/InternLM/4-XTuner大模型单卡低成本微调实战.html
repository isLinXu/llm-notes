

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>4-XTunerå¤§æ¨¡å‹å•å¡ä½æˆæœ¬å¾®è°ƒå®æˆ˜ &#8212; å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ ç¬”è®°</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'InternLM/4-XTunerå¤§æ¨¡å‹å•å¡ä½æˆæœ¬å¾®è°ƒå®æˆ˜';</script>
    <link rel="shortcut icon" href="../_static/panda.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5-LMDeployå¤§æ¨¡å‹é‡åŒ–éƒ¨ç½²å®è·µ" href="5-LMDeploy%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%87%8F%E5%8C%96%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html" />
    <link rel="prev" title="3-åŸºäºInternLMå’ŒLangchainæ­å»ºä½ çš„çŸ¥è¯†åº“" href="3-%E5%9F%BA%E4%BA%8EInternLM%E5%92%8CLangchain%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E7%9F%A5%E8%AF%86%E5%BA%93.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ç›®å½•</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">ä¹¦ç”ŸÂ·æµ¦è¯­å¤§æ¨¡å‹å®æˆ˜è¥</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1-%E4%B9%A6%E7%94%9F%E6%B5%A6%E8%AF%AD%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%80%E6%BA%90%E5%BC%80%E6%94%BE%E4%BD%93%E7%B3%BB.html">1-ä¹¦ç”Ÿæµ¦è¯­å¤§æ¨¡å‹å…¨é“¾è·¯å¼€æºå¼€æ”¾ä½“ç³»</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-%E8%BD%BB%E6%9D%BE%E5%88%86%E9%92%9F%E7%8E%A9%E8%BD%AC%E4%B9%A6%E7%94%9F%C2%B7%E6%B5%A6%E8%AF%AD%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%B6%A3%E5%91%B3Demo.html">2-è½»æ¾åˆ†é’Ÿç©è½¬ä¹¦ç”ŸÂ·æµ¦è¯­å¤§æ¨¡å‹è¶£å‘³Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-%E5%9F%BA%E4%BA%8EInternLM%E5%92%8CLangchain%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E7%9F%A5%E8%AF%86%E5%BA%93.html">3-åŸºäºInternLMå’ŒLangchainæ­å»ºä½ çš„çŸ¥è¯†åº“</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">4-XTunerå¤§æ¨¡å‹å•å¡ä½æˆæœ¬å¾®è°ƒå®æˆ˜</a></li>
<li class="toctree-l2"><a class="reference internal" href="5-LMDeploy%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%87%8F%E5%8C%96%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html">5-LMDeployå¤§æ¨¡å‹é‡åŒ–éƒ¨ç½²å®è·µ</a></li>

<li class="toctree-l2"><a class="reference internal" href="6-OpenCompass%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%AF%84%E6%B5%8B%E8%A7%A3%E8%AF%BB%E5%8F%8A%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97.html">6-OpenCompasså¤§æ¨¡å‹è¯„æµ‹è§£è¯»åŠå®æˆ˜æŒ‡å—</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/isLinXu/llm-notes" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/isLinXu/llm-notes/edit/main/InternLM/4-XTunerå¤§æ¨¡å‹å•å¡ä½æˆæœ¬å¾®è°ƒå®æˆ˜.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/isLinXu/llm-notes/issues/new?title=Issue%20on%20page%20%2FInternLM/4-XTunerå¤§æ¨¡å‹å•å¡ä½æˆæœ¬å¾®è°ƒå®æˆ˜.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/InternLM/4-XTunerå¤§æ¨¡å‹å•å¡ä½æˆæœ¬å¾®è°ƒå®æˆ˜.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>4-XTunerå¤§æ¨¡å‹å•å¡ä½æˆæœ¬å¾®è°ƒå®æˆ˜</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1 æ¦‚è¿°</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1.1 XTuner</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#llm-2023-11-01">1.2 æ”¯æŒçš„å¼€æºLLM (2023.11.01)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">1.3 ç‰¹è‰²</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">1.4 å¾®è°ƒåŸç†</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2 å¿«é€Ÿä¸Šæ‰‹</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">2.1 å¹³å°</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">2.2 å®‰è£…</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">2.3 å¾®è°ƒ</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">2.3.1 å‡†å¤‡é…ç½®æ–‡ä»¶</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">2.3.2 æ¨¡å‹ä¸‹è½½</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">2.3.3 æ•°æ®é›†ä¸‹è½½</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">2.3.4 ä¿®æ”¹é…ç½®æ–‡ä»¶</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">2.3.5 å¼€å§‹å¾®è°ƒ</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pth-huggingface-adapter">2.3.6 å°†å¾—åˆ°çš„ PTH æ¨¡å‹è½¬æ¢ä¸º HuggingFace æ¨¡å‹ï¼Œ<strong>å³ï¼šç”Ÿæˆ Adapter æ–‡ä»¶å¤¹</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">2.4 éƒ¨ç½²ä¸æµ‹è¯•</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#huggingface-adapter">2.4.1 å°† HuggingFace adapter åˆå¹¶åˆ°å¤§è¯­è¨€æ¨¡å‹ï¼š</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">2.4.2 ä¸åˆå¹¶åçš„æ¨¡å‹å¯¹è¯ï¼š</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#demo">2.4.3 Demo</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">3 è‡ªå®šä¹‰å¾®è°ƒ</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">3.1 æ¦‚è¿°</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">3.1.1 <strong>åœºæ™¯éœ€æ±‚</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">3.1.2 <strong>çœŸå®æ•°æ®é¢„è§ˆ</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">3.2 æ•°æ®å‡†å¤‡</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">3.2.1 å°†æ•°æ®è½¬ä¸º XTuner çš„æ•°æ®æ ¼å¼</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">3.2.2 åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">3.3 å¼€å§‹è‡ªå®šä¹‰å¾®è°ƒ</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">3.3.1 å‡†å¤‡é…ç½®æ–‡ä»¶</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">3.3.2 <strong>XTunerï¼å¯åŠ¨ï¼</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pth-huggingface">3.3.3 pth è½¬ huggingface</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">3.3.4 éƒ¨ç½²ä¸æµ‹è¯•</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ms-agent-llm-agent">4ã€è¡¥å……ã€‘ç”¨ MS-Agent æ•°æ®é›† èµ‹äºˆ LLM ä»¥ Agent èƒ½åŠ›</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">4.1 æ¦‚è¿°</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">4.2 å¾®è°ƒæ­¥éª¤</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">4.2.1 å‡†å¤‡å·¥ä½œ</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">4.2.2 å¼€å§‹å¾®è°ƒ</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">4.3 ç›´æ¥ä½¿ç”¨</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adapter">4.3.1 ä¸‹è½½ Adapter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#serper">4.3.2 æ·»åŠ  serper ç¯å¢ƒå˜é‡</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#xtuner-agent">4.3.3 xtuner + agentï¼Œå¯åŠ¨ï¼</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">4.3.4 æŠ¥é”™å¤„ç†</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">5 å…¶ä»–å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">6 æ³¨æ„äº‹é¡¹</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="xtuner">
<h1>4-XTunerå¤§æ¨¡å‹å•å¡ä½æˆæœ¬å¾®è°ƒå®æˆ˜<a class="headerlink" href="#xtuner" title="Permalink to this heading">#</a></h1>
<hr class="docutils" />
<p><img alt="head2" src="https://github.com/isLinXu/llm-notes/assets/59380685/0a9d83f4-7d99-4b34-8159-3d69f38fdc60" /></p>
<blockquote>
<div><p>æ€ä¹ˆç¡•å‘¢ï¼Œç¥å¤§å®¶ç‚¼ä¸¹æ„‰å¿«å§~ ğŸ˜™</p>
</div></blockquote>
<section id="id1">
<h2>1 æ¦‚è¿°<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<section id="id2">
<h3>1.1 XTuner<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>ä¸€ä¸ªå¤§è¯­è¨€æ¨¡å‹å¾®è°ƒå·¥å…·ç®±ã€‚<em>ç”±</em> <em>MMRazor</em> <em>å’Œ</em> <em>MMDeploy</em> <em>è”åˆå¼€å‘ã€‚</em></p>
</section>
<section id="llm-2023-11-01">
<h3>1.2 æ”¯æŒçš„å¼€æºLLM (2023.11.01)<a class="headerlink" href="#llm-2023-11-01" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong><a class="reference external" href="https://huggingface.co/internlm/internlm-7b">InternLM</a></strong> âœ…</p></li>
<li><p><a class="reference external" href="https://huggingface.co/meta-llama">Llamaï¼ŒLlama2</a></p></li>
<li><p><a class="reference external" href="https://huggingface.co/THUDM/chatglm2-6b">ChatGLM2</a>ï¼Œ<a class="reference external" href="https://huggingface.co/THUDM/chatglm3-6b-base">ChatGLM3</a></p></li>
<li><p><a class="reference external" href="https://huggingface.co/Qwen/Qwen-7B">Qwen</a></p></li>
<li><p><a class="reference external" href="https://huggingface.co/baichuan-inc/Baichuan-7B">Baichuan</a>ï¼Œ<a class="reference external" href="https://huggingface.co/baichuan-inc/Baichuan2-7B-Base">Baichuan2</a></p></li>
<li><p>â€¦â€¦</p></li>
<li><p><a class="reference external" href="https://huggingface.co/HuggingFaceH4/zephyr-7b-beta">Zephyr</a></p></li>
</ul>
</section>
<section id="id3">
<h3>1.3 ç‰¹è‰²<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>ğŸ¤“ <strong>å‚»ç“œåŒ–ï¼š</strong> ä»¥ é…ç½®æ–‡ä»¶ çš„å½¢å¼å°è£…äº†å¤§éƒ¨åˆ†å¾®è°ƒåœºæ™¯ï¼Œ<strong>0åŸºç¡€çš„éä¸“ä¸šäººå‘˜ä¹Ÿèƒ½ä¸€é”®å¼€å§‹å¾®è°ƒ</strong>ã€‚</p></li>
<li><p>ğŸƒ <strong>è½»é‡çº§ï¼š</strong> å¯¹äº 7B å‚æ•°é‡çš„LLMï¼Œ<strong>å¾®è°ƒæ‰€éœ€çš„æœ€å°æ˜¾å­˜ä»…ä¸º 8GB</strong> ï¼š <strong>æ¶ˆè´¹çº§æ˜¾å¡âœ…ï¼Œcolabâœ…</strong></p></li>
</ul>
</section>
<section id="id4">
<h3>1.4 å¾®è°ƒåŸç†<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<blockquote>
<div><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªè¶…å¤§çš„ç©å…·ï¼Œç°åœ¨ä½ æƒ³æ”¹é€ è¿™ä¸ªè¶…å¤§çš„ç©å…·ã€‚ä½†æ˜¯ï¼Œ<strong>å¯¹æ•´ä¸ªç©å…·è¿›è¡Œå…¨é¢çš„æ”¹åŠ¨ä¼šéå¸¸æ˜‚è´µ</strong>ã€‚</p>
</div></blockquote>
<p>â€» å› æ­¤ï¼Œä½ æ‰¾åˆ°äº†ä¸€ç§å« <strong>LoRA</strong> çš„æ–¹æ³•ï¼š<strong>åªå¯¹ç©å…·ä¸­çš„æŸäº›é›¶ä»¶è¿›è¡Œæ”¹åŠ¨ï¼Œè€Œä¸æ˜¯å¯¹æ•´ä¸ªç©å…·è¿›è¡Œå…¨é¢æ”¹åŠ¨</strong>ã€‚</p>
<p>â€» è€Œ <strong>QLoRA</strong> æ˜¯ LoRA çš„ä¸€ç§æ”¹è¿›ï¼šå¦‚æœä½ æ‰‹é‡Œåªæœ‰ä¸€æŠŠç”Ÿé”ˆçš„èºä¸åˆ€ï¼Œä¹Ÿèƒ½æ”¹é€ ä½ çš„ç©å…·ã€‚</p>
<ul class="simple">
<li><p><strong>Full</strong> :       ğŸ˜³ â†’ ğŸš²</p></li>
<li><p><strong><a class="reference external" href="http://arxiv.org/abs/2106.09685">LoRA</a></strong> :     ğŸ˜³ â†’ ğŸ›µ</p></li>
<li><p><strong><a class="reference external" href="http://arxiv.org/abs/2305.14314">QLoRA</a></strong> :   ğŸ˜³ â†’ ğŸ</p></li>
</ul>
<p><img alt="cat_fly" src="https://github.com/isLinXu/llm-notes/assets/59380685/e69dcc5c-26a8-4568-be15-98d705f7d357" /></p>
</section>
</section>
<section id="id5">
<h2>2 å¿«é€Ÿä¸Šæ‰‹<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h2>
<section id="id6">
<h3>2.1 å¹³å°<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h3>
<p>Ubuntu + Anaconda + CUDA/CUDNN + 8GB nvidiaæ˜¾å¡</p>
</section>
<section id="id7">
<h3>2.2 å®‰è£…<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># å¦‚æœä½ æ˜¯åœ¨ InternStudio å¹³å°ï¼Œåˆ™ä»æœ¬åœ° clone ä¸€ä¸ªå·²æœ‰ pytorch 2.0.1 çš„ç¯å¢ƒï¼š</span>
/root/share/install_conda_env_internlm_base.sh<span class="w"> </span>xtuner0.1.9
<span class="c1"># å¦‚æœä½ æ˜¯åœ¨å…¶ä»–å¹³å°ï¼š</span>
conda<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>xtuner0.1.9<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.10<span class="w"> </span>-y

<span class="c1"># æ¿€æ´»ç¯å¢ƒ</span>
conda<span class="w"> </span>activate<span class="w"> </span>xtuner0.1.9
<span class="c1"># è¿›å…¥å®¶ç›®å½• ï¼ˆ~çš„æ„æ€æ˜¯ â€œå½“å‰ç”¨æˆ·çš„homeè·¯å¾„â€ï¼‰</span>
<span class="nb">cd</span><span class="w"> </span>~
<span class="c1"># åˆ›å»ºç‰ˆæœ¬æ–‡ä»¶å¤¹å¹¶è¿›å…¥ï¼Œä»¥è·Ÿéšæœ¬æ•™ç¨‹</span>
mkdir<span class="w"> </span>xtuner019<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>xtuner019


<span class="c1"># æ‹‰å– 0.1.9 çš„ç‰ˆæœ¬æºç </span>
git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>v0.1.9<span class="w">  </span>https://github.com/InternLM/xtuner
<span class="c1"># æ— æ³•è®¿é—®githubçš„ç”¨æˆ·è¯·ä» gitee æ‹‰å–:</span>
<span class="c1"># git clone -b v0.1.9 https://gitee.com/Internlm/xtuner</span>

<span class="c1"># è¿›å…¥æºç ç›®å½•</span>
<span class="nb">cd</span><span class="w"> </span>xtuner

<span class="c1"># ä»æºç å®‰è£… XTuner</span>
pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;.[all]&#39;</span>
</pre></div>
</div>
<p>å®‰è£…å®Œåï¼Œå°±å¼€å§‹ææå‡†å¤‡å·¥ä½œäº†ã€‚ï¼ˆå‡†å¤‡åœ¨ oasst1 æ•°æ®é›†ä¸Šå¾®è°ƒ internlm-7b-chatï¼‰</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># åˆ›å»ºä¸€ä¸ªå¾®è°ƒ oasst1 æ•°æ®é›†çš„å·¥ä½œè·¯å¾„ï¼Œè¿›å…¥</span>
mkdir<span class="w"> </span>~/ft-oasst1<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/ft-oasst1
</pre></div>
</div>
</section>
<section id="id8">
<h3>2.3 å¾®è°ƒ<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h3>
<section id="id9">
<h4>2.3.1 å‡†å¤‡é…ç½®æ–‡ä»¶<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h4>
<p>XTuner æä¾›å¤šä¸ªå¼€ç®±å³ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¸‹åˆ—å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># åˆ—å‡ºæ‰€æœ‰å†…ç½®é…ç½®</span>
xtuner<span class="w"> </span>list-cfg
</pre></div>
</div>
<p><img alt="cfgs" src="https://github.com/isLinXu/llm-notes/assets/59380685/c0336227-46a8-47aa-89e5-24e2208d36c1" /></p>
<p>æ‹·è´ä¸€ä¸ªé…ç½®æ–‡ä»¶åˆ°å½“å‰ç›®å½•ï¼š
<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">xtuner</span> <span class="pre">copy-cfg</span> <span class="pre">${CONFIG_NAME}</span> <span class="pre">${SAVE_PATH}</span></code></p>
<p>åœ¨æœ¬æ¡ˆä¾‹ä¸­å³ï¼šï¼ˆæ³¨æ„æœ€åæœ‰ä¸ªè‹±æ–‡å¥å·ï¼Œä»£è¡¨å¤åˆ¶åˆ°å½“å‰è·¯å¾„ï¼‰</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ft-oasst1
xtuner<span class="w"> </span>copy-cfg<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3<span class="w"> </span>.
</pre></div>
</div>
<p>é…ç½®æ–‡ä»¶åçš„è§£é‡Šï¼š</p>
<blockquote>
<div><p>xtuner copy-cfg internlm_chat_7b_qlora_oasst1_e3 .</p>
</div></blockquote>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>æ¨¡å‹å</p></th>
<th class="head"><p>internlm_chat_7b</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ä½¿ç”¨ç®—æ³•</p></td>
<td><p>qlora</p></td>
</tr>
<tr class="row-odd"><td><p>æ•°æ®é›†</p></td>
<td><p>oasst1</p></td>
</tr>
<tr class="row-even"><td><p>æŠŠæ•°æ®é›†è·‘å‡ æ¬¡</p></td>
<td><p>è·‘3æ¬¡ï¼še3 (epoch 3 )</p></td>
</tr>
</tbody>
</table>
<p>*æ—  chatæ¯”å¦‚ <code class="docutils literal notranslate"><span class="pre">internlm-7b</span></code> ä»£è¡¨æ˜¯åŸºåº§(base)æ¨¡å‹</p>
</section>
<section id="id10">
<h4>2.3.2 æ¨¡å‹ä¸‹è½½<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h4>
<p>ä¸ç”¨ xtuner é»˜è®¤çš„<code class="docutils literal notranslate"><span class="pre">ä»</span> <span class="pre">huggingface</span> <span class="pre">æ‹‰å–æ¨¡å‹</span></code>ï¼Œè€Œæ˜¯æå‰ä» ~~OpenXLab~~ ModelScope ä¸‹è½½æ¨¡å‹åˆ°æœ¬åœ°</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæ”¾æ¨¡å‹æ–‡ä»¶ï¼Œé˜²æ­¢æ•£è½ä¸€åœ°</span>
mkdir<span class="w"> </span>~/ft-oasst1/internlm-chat-7b

<span class="c1"># è£…ä¸€ä¸‹æ‹‰å–æ¨¡å‹æ–‡ä»¶è¦ç”¨çš„åº“</span>
pip<span class="w"> </span>install<span class="w"> </span>modelscope

<span class="c1"># ä» modelscope ä¸‹è½½ä¸‹è½½æ¨¡å‹æ–‡ä»¶</span>
<span class="nb">cd</span><span class="w"> </span>~/ft-oasst1
apt<span class="w"> </span>install<span class="w"> </span>git<span class="w"> </span>git-lfs<span class="w"> </span>-y
git<span class="w"> </span>lfs<span class="w"> </span>install
git<span class="w"> </span>lfs<span class="w"> </span>clone<span class="w"> </span>https://modelscope.cn/Shanghai_AI_Laboratory/internlm-chat-7b.git<span class="w"> </span>-b<span class="w"> </span>v1.0.3
</pre></div>
</div>
</section>
<section id="id11">
<h4>2.3.3 æ•°æ®é›†ä¸‹è½½<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h4>
<blockquote>
<div><p>https://huggingface.co/datasets/timdettmers/openassistant-guanaco/tree/main</p>
</div></blockquote>
<p>ç”±äº huggingface ç½‘ç»œé—®é¢˜ï¼Œå’±ä»¬å·²ç»ç»™å¤§å®¶æå‰ä¸‹è½½å¥½äº†ï¼Œå¤åˆ¶åˆ°æ­£ç¡®ä½ç½®å³å¯ï¼š</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ft-oasst1
<span class="c1"># ...-guanaco åé¢æœ‰ä¸ªç©ºæ ¼å’Œè‹±æ–‡å¥å·å•Š</span>
cp<span class="w"> </span>-r<span class="w"> </span>/root/share/temp/datasets/openassistant-guanaco<span class="w"> </span>.
</pre></div>
</div>
<p>æ­¤æ—¶ï¼Œå½“å‰è·¯å¾„çš„æ–‡ä»¶åº”è¯¥é•¿è¿™æ ·ï¼š</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="p">|</span>--<span class="w"> </span>internlm-chat-7b
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>README.md
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>config.json
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>configuration.json
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>configuration_internlm.py
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>generation_config.json
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>modeling_internlm.py
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>pytorch_model-00001-of-00008.bin
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>pytorch_model-00002-of-00008.bin
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>pytorch_model-00003-of-00008.bin
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>pytorch_model-00004-of-00008.bin
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>pytorch_model-00005-of-00008.bin
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>pytorch_model-00006-of-00008.bin
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>pytorch_model-00007-of-00008.bin
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>pytorch_model-00008-of-00008.bin
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>pytorch_model.bin.index.json
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>special_tokens_map.json
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>tokenization_internlm.py
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>tokenizer.model
<span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span>tokenizer_config.json
<span class="p">|</span>--<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy.py
<span class="sb">`</span>--<span class="w"> </span>openassistant-guanaco
<span class="w">    </span><span class="p">|</span>--<span class="w"> </span>openassistant_best_replies_eval.jsonl
<span class="w">    </span><span class="sb">`</span>--<span class="w"> </span>openassistant_best_replies_train.jsonl
</pre></div>
</div>
</section>
<section id="id12">
<h4>2.3.4 ä¿®æ”¹é…ç½®æ–‡ä»¶<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h4>
<p>ä¿®æ”¹å…¶ä¸­çš„æ¨¡å‹å’Œæ•°æ®é›†ä¸º æœ¬åœ°è·¯å¾„</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ft-oasst1
vim<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy.py
</pre></div>
</div>
<p>å‡å·ä»£è¡¨è¦åˆ é™¤çš„è¡Œï¼ŒåŠ å·ä»£è¡¨è¦å¢åŠ çš„è¡Œã€‚</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span># ä¿®æ”¹æ¨¡å‹ä¸ºæœ¬åœ°è·¯å¾„
<span class="gd">- pretrained_model_name_or_path = &#39;internlm/internlm-chat-7b&#39;</span>
<span class="gi">+ pretrained_model_name_or_path = &#39;./internlm-chat-7b&#39;</span>

# ä¿®æ”¹è®­ç»ƒæ•°æ®é›†ä¸ºæœ¬åœ°è·¯å¾„
<span class="gd">- data_path = &#39;timdettmers/openassistant-guanaco&#39;</span>
<span class="gi">+ data_path = &#39;./openassistant-guanaco&#39;</span>
</pre></div>
</div>
<p><strong>å¸¸ç”¨è¶…å‚</strong></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>å‚æ•°å</p></th>
<th class="head"><p>è§£é‡Š</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>data_path</strong></p></td>
<td><p>æ•°æ®è·¯å¾„æˆ– HuggingFace ä»“åº“å</p></td>
</tr>
<tr class="row-odd"><td><p>max_length</p></td>
<td><p>å•æ¡æ•°æ®æœ€å¤§ Token æ•°ï¼Œè¶…è¿‡åˆ™æˆªæ–­</p></td>
</tr>
<tr class="row-even"><td><p>pack_to_max_length</p></td>
<td><p>æ˜¯å¦å°†å¤šæ¡çŸ­æ•°æ®æ‹¼æ¥åˆ° max_lengthï¼Œæé«˜ GPU åˆ©ç”¨ç‡</p></td>
</tr>
<tr class="row-odd"><td><p>accumulative_counts</p></td>
<td><p>æ¢¯åº¦ç´¯ç§¯ï¼Œæ¯å¤šå°‘æ¬¡ backward æ›´æ–°ä¸€æ¬¡å‚æ•°</p></td>
</tr>
<tr class="row-even"><td><p>evaluation_inputs</p></td>
<td><p>è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¼šæ ¹æ®ç»™å®šçš„é—®é¢˜è¿›è¡Œæ¨ç†ï¼Œä¾¿äºè§‚æµ‹è®­ç»ƒçŠ¶æ€</p></td>
</tr>
<tr class="row-odd"><td><p>evaluation_freq</p></td>
<td><p>Evaluation çš„è¯„æµ‹é—´éš” iter æ•°</p></td>
</tr>
<tr class="row-even"><td><p>â€¦â€¦</p></td>
<td><p>â€¦â€¦</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>å¦‚æœæƒ³æŠŠæ˜¾å¡çš„ç°å­˜åƒæ»¡ï¼Œå……åˆ†åˆ©ç”¨æ˜¾å¡èµ„æºï¼Œå¯ä»¥å°† <code class="docutils literal notranslate"><span class="pre">max_length</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> è¿™ä¸¤ä¸ªå‚æ•°è°ƒå¤§ã€‚</p>
</div></blockquote>
</section>
<section id="id13">
<h4>2.3.5 å¼€å§‹å¾®è°ƒ<a class="headerlink" href="#id13" title="Permalink to this heading">#</a></h4>
<p><strong>è®­ç»ƒï¼š</strong></p>
<p>xtuner train ${CONFIG_NAME_OR_PATH}</p>
<p><strong>ä¹Ÿå¯ä»¥å¢åŠ  deepspeed è¿›è¡Œè®­ç»ƒåŠ é€Ÿï¼š</strong></p>
<p>xtuner train ${CONFIG_NAME_OR_PATH} â€“deepspeed deepspeed_zero2</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ QLoRA ç®—æ³•åœ¨ oasst1 æ•°æ®é›†ä¸Šå¾®è°ƒ InternLM-7Bï¼š</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># å•å¡</span>
<span class="c1">## ç”¨åˆšæ‰æ”¹å¥½çš„configæ–‡ä»¶è®­ç»ƒ</span>
xtuner<span class="w"> </span>train<span class="w"> </span>./internlm_chat_7b_qlora_oasst1_e3_copy.py

<span class="c1"># å¤šå¡</span>
<span class="nv">NPROC_PER_NODE</span><span class="o">=</span><span class="si">${</span><span class="nv">GPU_NUM</span><span class="si">}</span><span class="w"> </span>xtuner<span class="w"> </span>train<span class="w"> </span>./internlm_chat_7b_qlora_oasst1_e3_copy.py

<span class="c1"># è‹¥è¦å¼€å¯ deepspeed åŠ é€Ÿï¼Œå¢åŠ  --deepspeed deepspeed_zero2 å³å¯</span>
</pre></div>
</div>
<blockquote>
<div><p>å¾®è°ƒå¾—åˆ°çš„ PTH æ¨¡å‹æ–‡ä»¶å’Œå…¶ä»–æ‚ä¸ƒæ‚å…«çš„æ–‡ä»¶éƒ½é»˜è®¤åœ¨å½“å‰çš„ <code class="docutils literal notranslate"><span class="pre">./work_dirs</span></code> ä¸­ã€‚</p>
</div></blockquote>
<p>è·‘å®Œè®­ç»ƒåï¼Œå½“å‰è·¯å¾„åº”è¯¥é•¿è¿™æ ·ï¼š</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="p">|</span>--<span class="w"> </span>internlm-chat-7b
<span class="p">|</span>--<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy.py
<span class="p">|</span>--<span class="w"> </span>openassistant-guanaco
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>openassistant_best_replies_eval.jsonl
<span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span>openassistant_best_replies_train.jsonl
<span class="sb">`</span>--<span class="w"> </span>work_dirs
<span class="w">    </span><span class="sb">`</span>--<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>20231101_152923
<span class="w">        </span><span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>20231101_152923.log
<span class="w">        </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span>vis_data
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>20231101_152923.json
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>config.py
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span>scalars.json
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>epoch_1.pth
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>epoch_2.pth
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>epoch_3.pth
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy.py
<span class="w">        </span><span class="sb">`</span>--<span class="w"> </span>last_checkpoint
</pre></div>
</div>
</section>
<section id="pth-huggingface-adapter">
<h4>2.3.6 å°†å¾—åˆ°çš„ PTH æ¨¡å‹è½¬æ¢ä¸º HuggingFace æ¨¡å‹ï¼Œ<strong>å³ï¼šç”Ÿæˆ Adapter æ–‡ä»¶å¤¹</strong><a class="headerlink" href="#pth-huggingface-adapter" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">xtuner</span> <span class="pre">convert</span> <span class="pre">pth_to_hf</span> <span class="pre">${CONFIG_NAME_OR_PATH}</span> <span class="pre">${PTH_file_dir}</span> <span class="pre">${SAVE_PATH}</span></code></p>
<p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œä¸ºï¼š</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>hf
<span class="nb">export</span><span class="w"> </span><span class="nv">MKL_SERVICE_FORCE_INTEL</span><span class="o">=</span><span class="m">1</span>

xtuner<span class="w"> </span>convert<span class="w"> </span>pth_to_hf<span class="w"> </span>./internlm_chat_7b_qlora_oasst1_e3_copy.py<span class="w"> </span>./work_dirs/internlm_chat_7b_qlora_oasst1_e3_copy/epoch_3.pth<span class="w"> </span>./hf
</pre></div>
</div>
<p>æ­¤æ—¶ï¼Œè·¯å¾„ä¸­åº”è¯¥é•¿è¿™æ ·ï¼š</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="p">|</span>--<span class="w"> </span>internlm-chat-7b
<span class="p">|</span>--<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy.py
<span class="p">|</span>--<span class="w"> </span>openassistant-guanaco
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>openassistant_best_replies_eval.jsonl
<span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span>openassistant_best_replies_train.jsonl
<span class="p">|</span>--<span class="w"> </span>hf
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>README.md
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>adapter_config.json
<span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>adapter_model.bin
<span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span>xtuner_config.py
<span class="sb">`</span>--<span class="w"> </span>work_dirs
<span class="w">    </span><span class="sb">`</span>--<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>20231101_152923
<span class="w">        </span><span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>20231101_152923.log
<span class="w">        </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span>vis_data
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>20231101_152923.json
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>config.py
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span>scalars.json
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>epoch_1.pth
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>epoch_2.pth
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>epoch_3.pth
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy.py
<span class="w">        </span><span class="sb">`</span>--<span class="w"> </span>last_checkpoint
</pre></div>
</div>
<p><span style="color: red;"><strong>æ­¤æ—¶ï¼Œhf æ–‡ä»¶å¤¹å³ä¸ºæˆ‘ä»¬å¹³æ—¶æ‰€ç†è§£çš„æ‰€è°“ â€œLoRA æ¨¡å‹æ–‡ä»¶â€</strong></span></p>
<blockquote>
<div><p>å¯ä»¥ç®€å•ç†è§£ï¼šLoRA æ¨¡å‹æ–‡ä»¶ = Adapter</p>
</div></blockquote>
</section>
</section>
<section id="id14">
<h3>2.4 éƒ¨ç½²ä¸æµ‹è¯•<a class="headerlink" href="#id14" title="Permalink to this heading">#</a></h3>
<section id="huggingface-adapter">
<h4>2.4.1 å°† HuggingFace adapter åˆå¹¶åˆ°å¤§è¯­è¨€æ¨¡å‹ï¼š<a class="headerlink" href="#huggingface-adapter" title="Permalink to this heading">#</a></h4>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>xtuner<span class="w"> </span>convert<span class="w"> </span>merge<span class="w"> </span>./internlm-chat-7b<span class="w"> </span>./hf<span class="w"> </span>./merged<span class="w"> </span>--max-shard-size<span class="w"> </span>2GB
<span class="c1"># xtuner convert merge \</span>
<span class="c1">#     ${NAME_OR_PATH_TO_LLM} \</span>
<span class="c1">#     ${NAME_OR_PATH_TO_ADAPTER} \</span>
<span class="c1">#     ${SAVE_PATH} \</span>
<span class="c1">#     --max-shard-size 2GB</span>
</pre></div>
</div>
</section>
<section id="id15">
<h4>2.4.2 ä¸åˆå¹¶åçš„æ¨¡å‹å¯¹è¯ï¼š<a class="headerlink" href="#id15" title="Permalink to this heading">#</a></h4>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># åŠ è½½ Adapter æ¨¡å‹å¯¹è¯ï¼ˆFloat 16ï¼‰</span>
xtuner<span class="w"> </span>chat<span class="w"> </span>./merged<span class="w"> </span>--prompt-template<span class="w"> </span>internlm_chat

<span class="c1"># 4 bit é‡åŒ–åŠ è½½</span>
<span class="c1"># xtuner chat ./merged --bits 4 --prompt-template internlm_chat</span>
</pre></div>
</div>
</section>
<section id="demo">
<h4>2.4.3 Demo<a class="headerlink" href="#demo" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>ä¿®æ”¹ <code class="docutils literal notranslate"><span class="pre">cli_demo.py</span></code> ä¸­çš„æ¨¡å‹è·¯å¾„</p></li>
</ul>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">- model_name_or_path = &quot;/root/model/Shanghai_AI_Laboratory/internlm-chat-7b&quot;</span>
<span class="gi">+ model_name_or_path = &quot;merged&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>è¿è¡Œ <code class="docutils literal notranslate"><span class="pre">cli_demo.py</span></code> ä»¥ç›®æµ‹å¾®è°ƒæ•ˆæœ</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>./cli_demo.py
</pre></div>
</div>
<p><strong>æ•ˆæœï¼š</strong></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>å¾®è°ƒå‰</p></th>
<th class="head"><p>å¾®è°ƒå</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><img alt="O23QD48iFSZMfbr.png" src="https://github.com/isLinXu/llm-notes/assets/59380685/75adff85-5435-4c70-9a67-2d1bdc34c9e6" /></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><img alt="beforeFT" src="https://github.com/isLinXu/llm-notes/assets/59380685/2a803c80-9fec-4e91-9929-c9e95ff2f88f" /></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p><strong><code class="docutils literal notranslate"><span class="pre">xtuner</span> <span class="pre">chat</span></code></strong> <strong>çš„å¯åŠ¨å‚æ•°</strong></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>å¯åŠ¨å‚æ•°</p></th>
<th class="head"><p>å¹²å“ˆæ»´</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>â€“prompt-template</strong></p></td>
<td><p>æŒ‡å®šå¯¹è¯æ¨¡æ¿</p></td>
</tr>
<tr class="row-odd"><td><p>â€“system</p></td>
<td><p>æŒ‡å®šSYSTEMæ–‡æœ¬</p></td>
</tr>
<tr class="row-even"><td><p>â€“system-template</p></td>
<td><p>æŒ‡å®šSYSTEMæ¨¡æ¿</p></td>
</tr>
<tr class="row-odd"><td><p>-<strong>-bits</strong></p></td>
<td><p>LLMä½æ•°</p></td>
</tr>
<tr class="row-even"><td><p>â€“bot-name</p></td>
<td><p>botåç§°</p></td>
</tr>
<tr class="row-odd"><td><p>â€“with-plugins</p></td>
<td><p>æŒ‡å®šè¦ä½¿ç”¨çš„æ’ä»¶</p></td>
</tr>
<tr class="row-even"><td><p><strong>â€“no-streamer</strong></p></td>
<td><p>æ˜¯å¦å¯ç”¨æµå¼ä¼ è¾“</p></td>
</tr>
<tr class="row-odd"><td><p><strong>â€“lagent</strong></p></td>
<td><p>æ˜¯å¦ä½¿ç”¨lagent</p></td>
</tr>
<tr class="row-even"><td><p>â€“command-stop-word</p></td>
<td><p>å‘½ä»¤åœæ­¢è¯</p></td>
</tr>
<tr class="row-odd"><td><p>â€“answer-stop-word</p></td>
<td><p>å›ç­”åœæ­¢è¯</p></td>
</tr>
<tr class="row-even"><td><p>â€“offload-folder</p></td>
<td><p>å­˜æ”¾æ¨¡å‹æƒé‡çš„æ–‡ä»¶å¤¹ï¼ˆæˆ–è€…å·²ç»å¸è½½æ¨¡å‹æƒé‡çš„æ–‡ä»¶å¤¹ï¼‰</p></td>
</tr>
<tr class="row-odd"><td><p>â€“max-new-tokens</p></td>
<td><p>ç”Ÿæˆæ–‡æœ¬ä¸­å…è®¸çš„æœ€å¤§ <code class="docutils literal notranslate"><span class="pre">token</span></code> æ•°é‡</p></td>
</tr>
<tr class="row-even"><td><p><strong>â€“temperature</strong></p></td>
<td><p>æ¸©åº¦å€¼</p></td>
</tr>
<tr class="row-odd"><td><p>â€“top-k</p></td>
<td><p>ä¿ç•™ç”¨äºé¡¶kç­›é€‰çš„æœ€é«˜æ¦‚ç‡è¯æ±‡æ ‡è®°æ•°</p></td>
</tr>
<tr class="row-even"><td><p>â€“top-p</p></td>
<td><p>å¦‚æœè®¾ç½®ä¸ºå°äº1çš„æµ®ç‚¹æ•°ï¼Œä»…ä¿ç•™æ¦‚ç‡ç›¸åŠ é«˜äº <code class="docutils literal notranslate"><span class="pre">top_p</span></code> çš„æœ€å°ä¸€ç»„æœ€æœ‰å¯èƒ½çš„æ ‡è®°</p></td>
</tr>
<tr class="row-odd"><td><p>â€“seed</p></td>
<td><p>ç”¨äºå¯é‡ç°æ–‡æœ¬ç”Ÿæˆçš„éšæœºç§å­</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="id16">
<h2>3 è‡ªå®šä¹‰å¾®è°ƒ<a class="headerlink" href="#id16" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>ä»¥ <strong><a class="reference external" href="https://github.com/abachaa/Medication_QA_MedInfo2019">Medication QA</a></strong> <strong>æ•°æ®é›†</strong>ä¸ºä¾‹</p>
</div></blockquote>
<section id="id17">
<h3>3.1 æ¦‚è¿°<a class="headerlink" href="#id17" title="Permalink to this heading">#</a></h3>
<section id="id18">
<h4>3.1.1 <strong>åœºæ™¯éœ€æ±‚</strong><a class="headerlink" href="#id18" title="Permalink to this heading">#</a></h4>
<p>åŸºäº InternLM-chat-7B æ¨¡å‹ï¼Œç”¨ MedQA æ•°æ®é›†è¿›è¡Œå¾®è°ƒï¼Œå°†å…¶å¾€<code class="docutils literal notranslate"><span class="pre">åŒ»å­¦é—®ç­”</span></code>é¢†åŸŸå¯¹é½ã€‚</p>
</section>
<section id="id19">
<h4>3.1.2 <strong>çœŸå®æ•°æ®é¢„è§ˆ</strong><a class="headerlink" href="#id19" title="Permalink to this heading">#</a></h4>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>é—®é¢˜</p></th>
<th class="head"><p>ç­”æ¡ˆ</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>What are ketorolac eye drops?ï¼ˆä»€ä¹ˆæ˜¯é…®å’¯é…¸æ»´çœ¼æ¶²ï¼Ÿï¼‰</p></td>
<td><p>Ophthalmic   ketorolac is used to treat itchy eyes caused by allergies. It also is used to   treat swelling and redness (inflammation) that can occur after cataract   surgery. Ketorolac is in a class of medications called nonsteroidal   anti-inflammatory drugs (NSAIDs). It works by stopping the release of   substances that cause allergy symptoms and inflammation.</p></td>
</tr>
<tr class="row-odd"><td><p>What medicines raise blood sugar? ï¼ˆä»€ä¹ˆè¯ç‰©ä¼šå‡é«˜è¡€ç³–ï¼Ÿï¼‰</p></td>
<td><p>Some   medicines for conditions other than diabetes can raise your blood sugar   level. This is a concern when you have diabetes. Make sure every doctor you   see knows about all of the medicines, vitamins, or herbal supplements you   take. This means anything you take with or without a prescription. Examples include:     Barbiturates.     Thiazide diuretics.     Corticosteroids.     Birth control pills (oral contraceptives) and progesterone.     Catecholamines.     Decongestants that contain beta-adrenergic agents, such as pseudoephedrine.     The B vitamin niacin. The risk of high blood sugar from niacin lowers after you have taken it for a few months. The antipsychotic medicine olanzapine (Zyprexa).</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="id20">
<h3>3.2 æ•°æ®å‡†å¤‡<a class="headerlink" href="#id20" title="Permalink to this heading">#</a></h3>
<blockquote>
<div><p><strong>ä»¥</strong> <strong><a class="reference external" href="https://github.com/abachaa/Medication_QA_MedInfo2019">Medication QA</a></strong> <strong>æ•°æ®é›†ä¸ºä¾‹</strong></p>
</div></blockquote>
<p><strong>åŸæ ¼å¼ï¼š(.xlsx)</strong></p>
<p><img alt="medqa2019samples" src="https://github.com/isLinXu/llm-notes/assets/59380685/d7bf50ae-46e4-4eca-97ed-41341261bf82" /></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>é—®é¢˜</strong></p></th>
<th class="head"><p>è¯ç‰©ç±»å‹</p></th>
<th class="head"><p>é—®é¢˜ç±»å‹</p></th>
<th class="head"><p><strong>å›ç­”</strong></p></th>
<th class="head"><p>ä¸»é¢˜</p></th>
<th class="head"><p>URL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>aaa</p></td>
<td><p>bbb</p></td>
<td><p>ccc</p></td>
<td><p>ddd</p></td>
<td><p>eee</p></td>
<td><p>fff</p></td>
</tr>
</tbody>
</table>
<section id="id21">
<h4>3.2.1 å°†æ•°æ®è½¬ä¸º XTuner çš„æ•°æ®æ ¼å¼<a class="headerlink" href="#id21" title="Permalink to this heading">#</a></h4>
<p><strong>ç›®æ ‡æ ¼å¼ï¼š(.jsonL)</strong></p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;conversation&quot;</span><span class="p">:[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;system&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;input&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;conversation&quot;</span><span class="p">:[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;system&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;input&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}]</span>
</pre></div>
</div>
<p>ğŸ§ é€šè¿‡ pytho nè„šæœ¬ï¼šå°† <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> ä¸­çš„ é—®é¢˜ å’Œ å›ç­” ä¸¤åˆ— æå–å‡ºæ¥ï¼Œå†æ”¾å…¥ <code class="docutils literal notranslate"><span class="pre">.jsonL</span></code> æ–‡ä»¶çš„æ¯ä¸ª conversation çš„ input å’Œ output ä¸­ã€‚</p>
<blockquote>
<div><p>è¿™ä¸€æ­¥çš„ python è„šæœ¬å¯ä»¥è¯· ChatGPT æ¥å®Œæˆã€‚</p>
</div></blockquote>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Write a python file for me. using openpyxl. input file name is MedQA2019.xlsx
Step1: The input file is .xlsx. Exact the column A and column D in the sheet named &quot;DrugQA&quot; .
Step2: Put each value in column A into each &quot;input&quot; of each &quot;conversation&quot;. Put each value in column D into each &quot;output&quot; of each &quot;conversation&quot;.
Step3: The output file is .jsonL. It looks like:
[{
    &quot;conversation&quot;:[
        {
            &quot;system&quot;: &quot;xxx&quot;,
            &quot;input&quot;: &quot;xxx&quot;,
            &quot;output&quot;: &quot;xxx&quot;
        }
    ]
},
{
    &quot;conversation&quot;:[
        {
            &quot;system&quot;: &quot;xxx&quot;,
            &quot;input&quot;: &quot;xxx&quot;,
            &quot;output&quot;: &quot;xxx&quot;
        }
    ]
}]
Step4: All &quot;system&quot; value changes to &quot;You are a professional, highly experienced doctor professor. You always provide accurate, comprehensive, and detailed answers based on the patients&#39; questions.&quot;
</pre></div>
</div>
<blockquote>
<div><p>ChatGPT ç”Ÿæˆçš„ python ä»£ç è§æœ¬ä»“åº“çš„ <span class="xref myst">xlsx2jsonl.py</span></p>
</div></blockquote>
<p>æ‰§è¡Œ python è„šæœ¬ï¼Œè·å¾—æ ¼å¼åŒ–åçš„æ•°æ®é›†ï¼š</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>xlsx2jsonl.py
</pre></div>
</div>
<p><strong>æ ¼å¼åŒ–åçš„æ•°æ®é›†é•¿è¿™æ ·ï¼š</strong></p>
<p><img alt="dataProcessed" src="https://github.com/isLinXu/llm-notes/assets/59380685/76cb6dc6-8a02-4e22-aa09-7b29920ea8ea" /></p>
<p>æ­¤æ—¶ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¯¹æ•°æ®è¿›è¡Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„åˆ†å‰²ï¼ŒåŒæ ·å¯ä»¥è®© ChatGPT å†™ python ä»£ç ã€‚å½“ç„¶å¦‚æœä½ æ²¡æœ‰ä¸¥æ ¼çš„ç§‘ç ”éœ€æ±‚ã€ä¸åœ¨ä¹â€œè®­ç»ƒé›†æ³„éœ²â€çš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ä¸åšè®­ç»ƒé›†ä¸æµ‹è¯•é›†çš„åˆ†å‰²ã€‚</p>
</section>
<section id="id22">
<h4>3.2.2 åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†<a class="headerlink" href="#id22" title="Permalink to this heading">#</a></h4>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>my .jsonL file looks like:
[{
    &quot;conversation&quot;:[
        {
            &quot;system&quot;: &quot;xxx&quot;,
            &quot;input&quot;: &quot;xxx&quot;,
            &quot;output&quot;: &quot;xxx&quot;
        }
    ]
},
{
    &quot;conversation&quot;:[
        {
            &quot;system&quot;: &quot;xxx&quot;,
            &quot;input&quot;: &quot;xxx&quot;,
            &quot;output&quot;: &quot;xxx&quot;
        }
    ]
}]
Step1, read the .jsonL file.
Step2, count the amount of the &quot;conversation&quot; elements.
Step3, randomly split all &quot;conversation&quot; elements by 7:3. Targeted structure is same as the input.
Step4, save the 7/10 part as train.jsonl. save the 3/10 part as test.jsonl
</pre></div>
</div>
<p>ç”Ÿæˆçš„pythonä»£ç è§ <span class="xref myst">split2train_and_test.py</span></p>
</section>
</section>
<section id="id23">
<h3>3.3 å¼€å§‹è‡ªå®šä¹‰å¾®è°ƒ<a class="headerlink" href="#id23" title="Permalink to this heading">#</a></h3>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬é‡æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ¥ç©â€œå¾®è°ƒè‡ªå®šä¹‰æ•°æ®é›†â€</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>~/ft-medqa<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/ft-medqa
</pre></div>
</div>
<p>æŠŠå‰é¢ä¸‹è½½å¥½çš„internlm-chat-7bæ¨¡å‹æ–‡ä»¶å¤¹æ‹·è´è¿‡æ¥ã€‚</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>-r<span class="w"> </span>~/ft-oasst1/internlm-chat-7b<span class="w"> </span>.
</pre></div>
</div>
<p>åˆ«å¿˜äº†æŠŠè‡ªå®šä¹‰æ•°æ®é›†ï¼Œå³å‡ ä¸ª <code class="docutils literal notranslate"><span class="pre">.jsonL</span></code>ï¼Œä¹Ÿä¼ åˆ°æœåŠ¡å™¨ä¸Šã€‚</p>
<section id="id24">
<h4>3.3.1 å‡†å¤‡é…ç½®æ–‡ä»¶<a class="headerlink" href="#id24" title="Permalink to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°å½“å‰ç›®å½•</span>
xtuner<span class="w"> </span>copy-cfg<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3<span class="w"> </span>.
<span class="c1"># æ”¹ä¸ªæ–‡ä»¶å</span>
mv<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy.py<span class="w"> </span>internlm_chat_7b_qlora_medqa2019_e3.py

<span class="c1"># ä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹</span>
vim<span class="w"> </span>internlm_chat_7b_qlora_medqa2019_e3.py
</pre></div>
</div>
<p>å‡å·ä»£è¡¨è¦åˆ é™¤çš„è¡Œï¼ŒåŠ å·ä»£è¡¨è¦å¢åŠ çš„è¡Œã€‚</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span># ä¿®æ”¹importéƒ¨åˆ†
<span class="gd">- from xtuner.dataset.map_fns import oasst1_map_fn, template_map_fn_factory</span>
<span class="gi">+ from xtuner.dataset.map_fns import template_map_fn_factory</span>

# ä¿®æ”¹æ¨¡å‹ä¸ºæœ¬åœ°è·¯å¾„
<span class="gd">- pretrained_model_name_or_path = &#39;internlm/internlm-chat-7b&#39;</span>
<span class="gi">+ pretrained_model_name_or_path = &#39;./internlm-chat-7b&#39;</span>

# ä¿®æ”¹è®­ç»ƒæ•°æ®ä¸º MedQA2019-structured-train.jsonl è·¯å¾„
<span class="gd">- data_path = &#39;timdettmers/openassistant-guanaco&#39;</span>
<span class="gi">+ data_path = &#39;./MedQA2019/MedQA2019-structured-train.jsonl&#39;</span>

# ä¿®æ”¹ train_dataset å¯¹è±¡
train_dataset = dict(
<span class="w"> </span>   type=process_hf_dataset,
<span class="gd">-   dataset=dict(type=load_dataset, path=data_path),</span>
<span class="gi">+   dataset=dict(type=load_dataset, path=&#39;json&#39;, data_files=dict(train=data_path)),</span>
<span class="w"> </span>   tokenizer=tokenizer,
<span class="w"> </span>   max_length=max_length,
<span class="gd">-   dataset_map_fn=alpaca_map_fn,</span>
<span class="gi">+   dataset_map_fn=None,</span>
<span class="w"> </span>   template_map_fn=dict(
<span class="w"> </span>       type=template_map_fn_factory, template=prompt_template),
<span class="w"> </span>   remove_unused_columns=True,
<span class="w"> </span>   shuffle_before_pack=True,
<span class="w"> </span>   pack_to_max_length=pack_to_max_length)
</pre></div>
</div>
</section>
<section id="id25">
<h4>3.3.2 <strong>XTunerï¼å¯åŠ¨ï¼</strong><a class="headerlink" href="#id25" title="Permalink to this heading">#</a></h4>
<p><img alt="ysqd" src="https://github.com/isLinXu/llm-notes/assets/59380685/57ed9cca-0407-4678-b82c-e56b200f216d" /></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xtuner<span class="w"> </span>train<span class="w"> </span>internlm_chat_7b_qlora_medqa2019_e3.py
</pre></div>
</div>
</section>
<section id="pth-huggingface">
<h4>3.3.3 pth è½¬ huggingface<a class="headerlink" href="#pth-huggingface" title="Permalink to this heading">#</a></h4>
<p>åŒå‰è¿°ï¼Œè¿™é‡Œä¸èµ˜è¿°äº†ã€‚<span class="xref myst">å°†å¾—åˆ°çš„-pth-æ¨¡å‹è½¬æ¢ä¸º-huggingface-æ¨¡å‹å³ç”Ÿæˆadapteræ–‡ä»¶å¤¹</span></p>
</section>
<section id="id26">
<h4>3.3.4 éƒ¨ç½²ä¸æµ‹è¯•<a class="headerlink" href="#id26" title="Permalink to this heading">#</a></h4>
<p>åŒå‰è¿°ã€‚<span class="xref myst">éƒ¨ç½²ä¸æµ‹è¯•</span></p>
</section>
</section>
</section>
<section id="ms-agent-llm-agent">
<h2>4ã€è¡¥å……ã€‘ç”¨ MS-Agent æ•°æ®é›† èµ‹äºˆ LLM ä»¥ Agent èƒ½åŠ›<a class="headerlink" href="#ms-agent-llm-agent" title="Permalink to this heading">#</a></h2>
<section id="id27">
<h3>4.1 æ¦‚è¿°<a class="headerlink" href="#id27" title="Permalink to this heading">#</a></h3>
<p>MSAgent æ•°æ®é›†æ¯æ¡æ ·æœ¬åŒ…å«ä¸€ä¸ªå¯¹è¯åˆ—è¡¨ï¼ˆconversationsï¼‰ï¼Œå…¶é‡Œé¢åŒ…å«äº† systemã€userã€assistant ä¸‰ç§å­—æ®µã€‚å…¶ä¸­ï¼š</p>
<ul class="simple">
<li><p>system: è¡¨ç¤ºç»™æ¨¡å‹å‰ç½®çš„äººè®¾è¾“å…¥ï¼Œå…¶ä¸­æœ‰å‘Šè¯‰æ¨¡å‹å¦‚ä½•è°ƒç”¨æ’ä»¶ä»¥åŠç”Ÿæˆè¯·æ±‚</p></li>
<li><p>user: è¡¨ç¤ºç”¨æˆ·çš„è¾“å…¥ promptï¼Œåˆ†ä¸ºä¸¤ç§ï¼Œé€šç”¨ç”Ÿæˆçš„promptå’Œè°ƒç”¨æ’ä»¶éœ€æ±‚çš„ prompt</p></li>
<li><p>assistant: ä¸ºæ¨¡å‹çš„å›å¤ã€‚å…¶ä¸­ä¼šåŒ…æ‹¬æ’ä»¶è°ƒç”¨ä»£ç å’Œæ‰§è¡Œä»£ç ï¼Œè°ƒç”¨ä»£ç æ˜¯è¦ LLM ç”Ÿæˆçš„ï¼Œè€Œæ‰§è¡Œä»£ç æ˜¯è°ƒç”¨æœåŠ¡æ¥ç”Ÿæˆç»“æœçš„</p></li>
</ul>
<p>ä¸€æ¡è°ƒç”¨ç½‘é¡µæœç´¢æ’ä»¶æŸ¥è¯¢â€œä¸Šæµ·æ˜å¤©å¤©æ°”â€çš„æ•°æ®æ ·æœ¬ç¤ºä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img alt="msagent_data" src="https://github.com/isLinXu/llm-notes/assets/59380685/6c94b4db-e503-4b81-99c9-ade7ad2f601a" /></p>
</section>
<section id="id28">
<h3>4.2 å¾®è°ƒæ­¥éª¤<a class="headerlink" href="#id28" title="Permalink to this heading">#</a></h3>
<section id="id29">
<h4>4.2.1 å‡†å¤‡å·¥ä½œ<a class="headerlink" href="#id29" title="Permalink to this heading">#</a></h4>
<blockquote>
<div><p>xtuner æ˜¯ä»å›½å†…çš„ ModelScope å¹³å°ä¸‹è½½ MS-Agent æ•°æ®é›†ï¼Œå› æ­¤ä¸ç”¨æå‰æ‰‹åŠ¨ä¸‹è½½æ•°æ®é›†æ–‡ä»¶ã€‚</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># å‡†å¤‡å·¥ä½œ</span>
mkdir<span class="w"> </span>~/ft-msagent<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/ft-msagent
cp<span class="w"> </span>-r<span class="w"> </span>~/ft-oasst1/internlm-chat-7b<span class="w"> </span>.

<span class="c1"># æŸ¥çœ‹é…ç½®æ–‡ä»¶</span>
xtuner<span class="w"> </span>list-cfg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>msagent

<span class="c1"># å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°å½“å‰ç›®å½•</span>
xtuner<span class="w"> </span>copy-cfg<span class="w"> </span>internlm_7b_qlora_msagent_react_e3_gpu8<span class="w"> </span>.

<span class="c1"># ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡å‹ä¸ºæœ¬åœ°è·¯å¾„</span>
vim<span class="w"> </span>./internlm_7b_qlora_msagent_react_e3_gpu8_copy.py<span class="w"> </span>
</pre></div>
</div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">- pretrained_model_name_or_path = &#39;internlm/internlm-chat-7b&#39;</span>
<span class="gi">+ pretrained_model_name_or_path = &#39;./internlm-chat-7b&#39;</span>
</pre></div>
</div>
</section>
<section id="id30">
<h4>4.2.2 å¼€å§‹å¾®è°ƒ<a class="headerlink" href="#id30" title="Permalink to this heading">#</a></h4>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>xtuner<span class="w"> </span>train<span class="w"> </span>./internlm_7b_qlora_msagent_react_e3_gpu8_copy.py<span class="w"> </span>--deepspeed<span class="w"> </span>deepspeed_zero2
</pre></div>
</div>
</section>
</section>
<section id="id31">
<h3>4.3 ç›´æ¥ä½¿ç”¨<a class="headerlink" href="#id31" title="Permalink to this heading">#</a></h3>
<blockquote>
<div><p>ç”±äº msagent çš„è®­ç»ƒéå¸¸è´¹æ—¶ï¼Œå¤§å®¶å¦‚æœæƒ³å°½å¿«æŠŠè¿™ä¸ªæ•™ç¨‹è·Ÿå®Œï¼Œå¯ä»¥ç›´æ¥ä» modelScope æ‹‰å–å’±ä»¬å·²ç»å¾®è°ƒå¥½äº†çš„ Adapterã€‚å¦‚ä¸‹æ¼”ç¤ºã€‚</p>
</div></blockquote>
<section id="adapter">
<h4>4.3.1 ä¸‹è½½ Adapter<a class="headerlink" href="#adapter" title="Permalink to this heading">#</a></h4>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ft-msagent
apt<span class="w"> </span>install<span class="w"> </span>git<span class="w"> </span>git-lfs
git<span class="w"> </span>lfs<span class="w"> </span>install
git<span class="w"> </span>lfs<span class="w"> </span>clone<span class="w"> </span>https://www.modelscope.cn/xtuner/internlm-7b-qlora-msagent-react.git
</pre></div>
</div>
<p>OKï¼Œç°åœ¨ç›®å½•åº”è¯¥é•¿è¿™æ ·ï¼š</p>
<ul class="simple">
<li><p>internlm_7b_qlora_msagent_react_e3_gpu8_copy.py</p></li>
<li><p>internlm-7b-qlora-msagent-react</p></li>
<li><p>internlm-chat-7b</p></li>
<li><p>work_dirï¼ˆå¯æœ‰å¯æ— ï¼‰</p></li>
</ul>
<p>æœ‰äº†è¿™ä¸ªåœ¨ msagent ä¸Šè®­ç»ƒå¾—åˆ°çš„Adapterï¼Œæ¨¡å‹ç°åœ¨å·²ç»æœ‰ agent èƒ½åŠ›äº†ï¼å°±å¯ä»¥åŠ  â€“lagent ä»¥è°ƒç”¨æ¥è‡ª lagent çš„ä»£ç†åŠŸèƒ½äº†ï¼</p>
</section>
<section id="serper">
<h4>4.3.2 æ·»åŠ  serper ç¯å¢ƒå˜é‡<a class="headerlink" href="#serper" title="Permalink to this heading">#</a></h4>
<blockquote>
<div><p><strong>å¼€å§‹ chat ä¹‹å‰ï¼Œè¿˜è¦åŠ ä¸ª serper çš„ç¯å¢ƒå˜é‡ï¼š</strong></p>
<p>å» serper.dev å…è´¹æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç”Ÿæˆè‡ªå·±çš„ api keyã€‚è¿™ä¸ªä¸œè¥¿æ˜¯ç”¨æ¥ç»™ lagent å»è·å– google æœç´¢çš„ç»“æœçš„ã€‚ç­‰äºæ˜¯ serper.dev å¸®ä½ å»è®¿é—® googleï¼Œè€Œä¸æ˜¯ä»ä½ è‡ªå·±æœ¬åœ°å»è®¿é—® google äº†ã€‚</p>
</div></blockquote>
<p><img alt="serper" src="https://github.com/isLinXu/llm-notes/assets/59380685/95138c9a-dcd7-413f-af93-7bafd3a81eb6" /></p>
<p>æ·»åŠ  serper api key åˆ°ç¯å¢ƒå˜é‡ï¼š</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SERPER_API_KEY</span><span class="o">=</span>abcdefg
</pre></div>
</div>
</section>
<section id="xtuner-agent">
<h4>4.3.3 xtuner + agentï¼Œå¯åŠ¨ï¼<a class="headerlink" href="#xtuner-agent" title="Permalink to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xtuner<span class="w"> </span>chat<span class="w"> </span>./internlm-chat-7b<span class="w"> </span>--adapter<span class="w"> </span>internlm-7b-qlora-msagent-react<span class="w"> </span>--lagent
</pre></div>
</div>
</section>
<section id="id32">
<h4>4.3.4 æŠ¥é”™å¤„ç†<a class="headerlink" href="#id32" title="Permalink to this heading">#</a></h4>
<p>xtuner chat å¢åŠ  â€“lagent å‚æ•°åï¼ŒæŠ¥é”™ <code class="docutils literal notranslate"><span class="pre">TypeError:</span> <span class="pre">transfomers.modelsauto.auto</span> <span class="pre">factory.</span> <span class="pre">BaseAutoModelClass.from</span> <span class="pre">pretrained()</span> <span class="pre">got</span> <span class="pre">multiple</span> <span class="pre">values</span> <span class="pre">for</span> <span class="pre">keyword</span> <span class="pre">argument</span> <span class="pre">&quot;trust</span> <span class="pre">renote</span> <span class="pre">code&quot;</span></code></p>
<p>æ³¨é‡Šæ‰å·²å®‰è£…åŒ…ä¸­çš„ä»£ç ï¼š</p>
<p><img alt="serper" src="https://github.com/isLinXu/llm-notes/assets/59380685/6dd68dc9-142b-4e58-9cfc-a5a192f2c4e5" /></p>
<p><img alt="bugfix2" src="https://github.com/isLinXu/llm-notes/assets/59380685/0c516466-106e-47f5-8bb1-a4fd418ab2c8" /></p>
</section>
</section>
</section>
<section id="id33">
<h2>5 å…¶ä»–å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š<a class="headerlink" href="#id33" title="Permalink to this heading">#</a></h2>
<p>https://docs.qq.com/doc/DY1d2ZVFlbXlrUERj</p>
<p>å°ä½œä¸šåŠ©æ•™è€å¸ˆä¼šåœ¨ç¤¾ç¾¤ä¸­å…¬å¸ƒã€‚
Have fun!</p>
</section>
<section id="id34">
<h2>6 æ³¨æ„äº‹é¡¹<a class="headerlink" href="#id34" title="Permalink to this heading">#</a></h2>
<p>æœ¬æ•™ç¨‹ä½¿ç”¨ xtuner 0.1.9 ç‰ˆæœ¬
è‹¥éœ€è¦è·Ÿç€æœ¬æ•™ç¨‹ä¸€æ­¥ä¸€æ­¥å®Œæˆï¼Œå»ºè®®ä¸¥æ ¼éµå¾ªæœ¬æ•™ç¨‹çš„æ­¥éª¤ï¼</p>
<p>è‹¥å‡ºç°è«åå…¶å¦™æŠ¥é”™ï¼Œè¯·å°è¯•æ›´æ¢ä¸ºä»¥ä¸‹åŒ…çš„ç‰ˆæœ¬ï¼šï¼ˆå¦‚æœæœ‰æŠ¥é”™å†æ£€æŸ¥ï¼Œæ²¡æŠ¥é”™ä¸ç”¨çœ‹ï¼‰</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span>                         <span class="mf">2.1.1</span>
<span class="n">transformers</span>                  <span class="mf">4.34.0</span>
<span class="n">transformers</span><span class="o">-</span><span class="n">stream</span><span class="o">-</span><span class="n">generator</span> <span class="mf">0.0.4</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">torch</span><span class="o">==</span><span class="m">2</span>.1.1
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">transformers</span><span class="o">==</span><span class="m">4</span>.34.0
pip<span class="w"> </span>install<span class="w"> </span>transformers-stream-generator<span class="o">=</span><span class="m">0</span>.0.4
</pre></div>
</div>
<p>CUDA ç›¸å…³ï¼šï¼ˆå¦‚æœæœ‰æŠ¥é”™å†æ£€æŸ¥ï¼Œæ²¡æŠ¥é”™ä¸ç”¨çœ‹ï¼‰</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NVIDIA</span><span class="o">-</span><span class="n">SMI</span> <span class="mf">535.54.03</span>              
<span class="n">Driver</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">535.54.03</span>    
<span class="n">CUDA</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">12.2</span>

<span class="n">nvidia</span><span class="o">-</span><span class="n">cuda</span><span class="o">-</span><span class="n">cupti</span><span class="o">-</span><span class="n">cu12</span>        <span class="mf">12.1.105</span>
<span class="n">nvidia</span><span class="o">-</span><span class="n">cuda</span><span class="o">-</span><span class="n">nvrtc</span><span class="o">-</span><span class="n">cu12</span>        <span class="mf">12.1.105</span>
<span class="n">nvidia</span><span class="o">-</span><span class="n">cuda</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="n">cu12</span>      <span class="mf">12.1.105</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="3-%E5%9F%BA%E4%BA%8EInternLM%E5%92%8CLangchain%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E7%9F%A5%E8%AF%86%E5%BA%93.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">3-åŸºäºInternLMå’ŒLangchainæ­å»ºä½ çš„çŸ¥è¯†åº“</p>
      </div>
    </a>
    <a class="right-next"
       href="5-LMDeploy%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%87%8F%E5%8C%96%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">5-LMDeployå¤§æ¨¡å‹é‡åŒ–éƒ¨ç½²å®è·µ</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1 æ¦‚è¿°</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1.1 XTuner</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#llm-2023-11-01">1.2 æ”¯æŒçš„å¼€æºLLM (2023.11.01)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">1.3 ç‰¹è‰²</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">1.4 å¾®è°ƒåŸç†</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2 å¿«é€Ÿä¸Šæ‰‹</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">2.1 å¹³å°</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">2.2 å®‰è£…</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">2.3 å¾®è°ƒ</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">2.3.1 å‡†å¤‡é…ç½®æ–‡ä»¶</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">2.3.2 æ¨¡å‹ä¸‹è½½</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">2.3.3 æ•°æ®é›†ä¸‹è½½</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">2.3.4 ä¿®æ”¹é…ç½®æ–‡ä»¶</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">2.3.5 å¼€å§‹å¾®è°ƒ</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pth-huggingface-adapter">2.3.6 å°†å¾—åˆ°çš„ PTH æ¨¡å‹è½¬æ¢ä¸º HuggingFace æ¨¡å‹ï¼Œ<strong>å³ï¼šç”Ÿæˆ Adapter æ–‡ä»¶å¤¹</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">2.4 éƒ¨ç½²ä¸æµ‹è¯•</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#huggingface-adapter">2.4.1 å°† HuggingFace adapter åˆå¹¶åˆ°å¤§è¯­è¨€æ¨¡å‹ï¼š</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">2.4.2 ä¸åˆå¹¶åçš„æ¨¡å‹å¯¹è¯ï¼š</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#demo">2.4.3 Demo</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">3 è‡ªå®šä¹‰å¾®è°ƒ</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">3.1 æ¦‚è¿°</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">3.1.1 <strong>åœºæ™¯éœ€æ±‚</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">3.1.2 <strong>çœŸå®æ•°æ®é¢„è§ˆ</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">3.2 æ•°æ®å‡†å¤‡</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">3.2.1 å°†æ•°æ®è½¬ä¸º XTuner çš„æ•°æ®æ ¼å¼</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">3.2.2 åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">3.3 å¼€å§‹è‡ªå®šä¹‰å¾®è°ƒ</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">3.3.1 å‡†å¤‡é…ç½®æ–‡ä»¶</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">3.3.2 <strong>XTunerï¼å¯åŠ¨ï¼</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pth-huggingface">3.3.3 pth è½¬ huggingface</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">3.3.4 éƒ¨ç½²ä¸æµ‹è¯•</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ms-agent-llm-agent">4ã€è¡¥å……ã€‘ç”¨ MS-Agent æ•°æ®é›† èµ‹äºˆ LLM ä»¥ Agent èƒ½åŠ›</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">4.1 æ¦‚è¿°</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">4.2 å¾®è°ƒæ­¥éª¤</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">4.2.1 å‡†å¤‡å·¥ä½œ</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">4.2.2 å¼€å§‹å¾®è°ƒ</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">4.3 ç›´æ¥ä½¿ç”¨</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adapter">4.3.1 ä¸‹è½½ Adapter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#serper">4.3.2 æ·»åŠ  serper ç¯å¢ƒå˜é‡</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#xtuner-agent">4.3.3 xtuner + agentï¼Œå¯åŠ¨ï¼</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">4.3.4 æŠ¥é”™å¤„ç†</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">5 å…¶ä»–å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">6 æ³¨æ„äº‹é¡¹</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By isLinXu
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2024, isLinXu.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>